_format_version: "3.0"

services:
  - name: bff-grpc-service
    protocol: grpc
    host: bff
    port: 50054

  - name: auth-service
    protocol: http
    host: auth
    port: 8000

routes:
  - name: bff-grpc-route
    protocols:
      - grpc
    paths:
      - "/bff.v1.Bff/GetProfile"
      - "/bff.v1.Bff/UpdateProfile"
      - "/bff.v1.Bff/CreateRoom"
      - "/bff.v1.Bff/StreamChat"
      - "/bff.v1.Bff/History"
    service: bff-grpc-service
    plugins:
      - name: opentelemetry
        config:
          traces_endpoint: http://otel-collector:4318/v1/traces
          resource_attributes:
            service.name: kong-gateway
            service.version: 1.0.0
          sampling_rate: 1.0
          connect_timeout: 10000
          read_timeout: 10000
          send_timeout: 10000
          propagation:
            default_format: w3c
            extract:
              - w3c
              - jaeger
            inject:
              - w3c

  - name: auth-github-route
    protocols:
      - http
    paths:
      - /auth/github
    service: auth-service
    strip_path: false
    plugins:
      - name: opentelemetry
        config:
          traces_endpoint: http://otel-collector:4318/v1/traces
          resource_attributes:
            service.name: kong-gateway
            service.version: 1.0.0
          sampling_rate: 1.0
          connect_timeout: 10000
          read_timeout: 10000
          send_timeout: 10000
          propagation:
            default_format: w3c
            extract:
              - w3c
              - jaeger
            inject:
              - w3c

  - name: auth-callback-route
    protocols:
      - http
    paths:
      - /auth/github/callback
    service: auth-service
    strip_path: false
    plugins:
      - name: opentelemetry
        config:
          traces_endpoint: http://otel-collector:4318/v1/traces
          resource_attributes:
            service.name: kong-gateway
            service.version: 1.0.0
          sampling_rate: 1.0
          connect_timeout: 10000
          read_timeout: 10000
          send_timeout: 10000
          propagation:
            default_format: w3c
            extract:
              - w3c
              - jaeger
            inject:
              - w3c

plugins:
  - name: token-transformer
    service: bff-grpc-service